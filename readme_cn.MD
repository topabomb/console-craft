# console-craft

([english](readme.MD)/[ç®€ä½“ä¸­æ–‡](readme_cn.MD))

ç®€åŒ–æ§åˆ¶å°ç¨‹åºå¼€å‘ï¼Œæ ‡å‡†åŒ–ç¨‹åºå‚æ•°å’Œæ—¥å¿—è¾“å‡ºï¼Œæ”¯æŒç”¨æˆ·äº¤äº’æˆ–è€…å‘½ä»¤è¡Œå‚æ•°æ–¹å¼æ¥å¯åŠ¨ç¨‹åºå’Œå­å‘½ä»¤ã€‚

## ä»‹ç»

- æ”¯æŒå¤šä¸ªå­å‘½ä»¤

- å…¨å±€å‚æ•°åŠå­å‘½ä»¤å‚æ•°

- ç¨‹åºå‚æ•°å¯ä»¥ä»ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œä¸­è·å–

- å†…ç½® dotenv å¤„ç†ï¼Œç¨‹åºå‚æ•°äº¦å¯ä» dotenv ä¸­è·å–

- å‚æ•°æ¥æºä¼˜å…ˆçº§ï¼šäº¤äº’è¾“å…¥>å‘½ä»¤è¡Œå‚æ•°>ç¯å¢ƒå˜é‡>dotenv

- å¯ä»¥é€šè¿‡ç”¨æˆ·äº¤äº’æ¥é€‰æ‹©å­å‘½ä»¤å’Œå‚æ•°

- å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ¥ç›´æ¥å¯åŠ¨å­å‘½ä»¤

- å†…ç½®äº† log4js åº“ï¼Œé€šè¿‡å‚æ•°æ¥è®¾ç½® log çš„æ ¼å¼

- å†…ç½®äº† commanderã€inquirerã€chalkï¼Œç”¨äºä¸°å¯Œç¨‹åºçš„äº¤äº’åŠå¤–è§‚

## æ¼”ç¤º

- ä»£ç æ ·ä¾‹ï¼Œ[GitHub - topabomb/console-craft-example](https://github.com/topabomb/console-craft-example)

  > è¯¥ç¨‹åºåŒ…æ‹¬ serve åŠ test ä¸¤ä¸ªå­å‘½ä»¤ï¼Œserve ä¸­å¯åŠ¨ä¸€ä¸ª http æœåŠ¡ç«¯ç¨‹åºï¼Œtest ç›´æ¥è°ƒç”¨ mocha çš„æœ¬åœ°æµ‹è¯•ã€‚

```typescript
import { execa } from "execa";
import { cli } from "console-craft";
import { service } from "./serve";
const commands = [
  { name: "serve", args: [{ flags: "-p, --port <port>", default: 3000 }] },
  { name: "test", args: ["-r, --round <round>"] },
];
cli.initialize(commands, {
  globalArgs: [
    { flags: "-c, --config <config>", description: "config file" },
    "-log,  --log-level",
  ],
  author: "topabomb(hualei.hb@gmail.com)",
  description: "node console app.",
});
cli.command("serve", async ({ name, args, logger }) => {
  const port = Number(args["port"]);
  await service.start(port);
  logger.level = args["log-level"] ? args["log-level"] : "debug";
  logger.info(`${name} listening : http://localhost:${args["port"]}`);
});
cli.command("test", async ({ name, args, logger }) => {
  await service.start(3000);
  const round = args["round"] ? Number(args["round"]) : 1;
  for (let i = 0; i < round; i++)
    await execa("npm", ["run", "test"]).pipeStdout(process.stdout);
  await service.close();
  logger.log("test complete.");
});
void cli.run();
```

- äº¤äº’æ¨¡å¼æˆªå›¾

  - serve

  ![](./assets/readme_cn/2023-10-18-11-43-08-1697600584883.png)

  - test

  ![](./assets/readme_cn/2023-10-18-11-44-08-image.png)

- å‘½ä»¤è¡Œå‚æ•°æ¨¡å¼æˆªå›¾

  - serve

  ![](./assets/readme_cn/2023-10-18-11-45-14-image.png)

  - test

    ![](./assets/readme_cn/2023-10-18-11-46-24-image.png)

## å®‰è£…

```shell
npm install console-craft
```

## ä½¿ç”¨è¯´æ˜

### cli

- initialize

  ```typescript
  cli.initialize(commands, {
    globalArgs: [
      { flags: "-c, --config <config>", description: "config file" },
      "-log,  --log-level",
    ],
    author: "topabomb(hualei.hb@gmail.com)",
    description: "node console app.",
  });
  ```

  flags format:

  ```
  -short, --long <name>
  -short, --long [name]
  -short, --long
  -short
  --long
  ```

- command

  ```typescript
  cli.command("serve", async (cmd) => {
    const port = Number(cmd.args["port"]);
    await service.start(port);
    cmd.logger.info(
      `${cmd.name} listening : http://localhost:${cmd.args["port"]}`
    );
  });
  ```

- run

  ```typescript
  void cli.run();
  ```

### inquirer

[GitHub - SBoudrias/Inquirer.js: A collection of common interactive command line user interfaces.](https://github.com/SBoudrias/Inquirer.js)

### chalk

[GitHub - chalk/chalk: ğŸ– Terminal string styling done right](https://github.com/chalk/chalk/)

### logger

https://log4js-node.github.io/log4js-node/
